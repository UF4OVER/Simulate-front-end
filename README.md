# 一，基于SC8802与SH367303的4-CELLS模拟前端开发板
# 最新进展
1. 截止到1st-April,板子已上传
![img.png](pic/img.png)

## （一）制作思路

### 1.使用SC8802作为BUCK-BOOST双向变换器为电池组降压充电或者升压放电，维持电源的一致性。
### 2.使用SH367303作为电池组主控，外部均衡。
### 3.使用外部mcu进行图像处理
### 4.使用显示屏实时显示电池组状态
> #### 补充：使用**STC2360** 输出几种不同电压
## （二）主拓扑
![img.png](pic/tuobu.png)
## （三）制作目的
主要是练习单片机寄存器的读取，熟悉TWI协议，练习I2C的使用，本人主要使用micro python进行编程，主要是练习这个主流语言的，<b>我其实是一个弱鸡。</b>做着玩玩反正本人现在手上也有许多电池，想着玩玩模拟前端
## （四）电路图一览
### 保护电路
![img](pic/SCH_模拟前端开发板_1-SH367303_2024-03-28.png)
### BUCK-BOOST升降压变换
![img](pic/SCH_模拟前端开发板_2-SC8802_2024-03-28.png)
### TYPE-C诱骗
![img](pic/SCH_模拟前端开发板_4-TYPE-C_2024-03-28.png)
### STC2360降压电路
![img](pic/SCH_模拟前端开发板_3-STC2360_2024-03-28.png)

### 板子还是得改动，暂时不能直接打板来做

# 二，原理详解/计算

## 其他引脚的设置
### 最低工作电压，通过VREF脚设置最低充电电压，最低8V吧，再低的话效率就上不去了
- 分压电阻的设置，设置为上电阻56kΩ，下电阻10kΩ，计算之后最低工作电压大概是8.09v，符合预期
- ![img.png](pic/分压电阻.png)

### 充电过程的冲电截止电压也一并设置了，因为使用的是4串的方案，充电电压截止在16.8v~16.9v这样 ~~考虑到mos上的压降？~~

+ 充电截止电压靠的是FB2引脚的外部分压决定，首先**将CSEL引脚0Ω接地**，其次配置FB2引脚，**下电阻11kΩ与400Ω串联，上电阻130kΩ与16kΩ串联**，精度%1就行，别问为什么，问就是手头没有其他的电阻！！！计算后的充电截止电压为**16.84456v**，符合预期
+ ![img.png](pic/FB2配置.png)
## 1.充电过程（不需要BAT端的限流作用）
### 1. ~~我服了直接好难啊~~，言归正传让我们开始吧！
### 2. 首先，**DIR**引脚拉低,ILIM1连接到**ITUNE**,ILIM2通过RSS连接到地
### 3. 充电限流调节 **（6A为例）**,放电同理
- （1，需要充电限流功能，直接选用芯片手册中的，限流电阻10mΩ，RSS = 1kΩ
- > 原话：RSNSx表示功率路径上的电流采样电阻（x代表1或2），当
电流流经时，电阻两端产生电压差。RSSx和 RSSx’将产生的
差分电压反馈回SC8802以此获取电流信息。CSSx滤波电容
用于滤除差分噪声，典型值为47pF。
- （2，**ILIM2**引脚通过一个电阻接到地，RILIM2 = 120kΩ
- （3，**ITUNE**连接到**RLIM1**，RILIM1 = 120kΩ
- （4，另提一嘴，RSS引脚与RILIM不是一个电阻，容易混淆
- （5，最后引出IPWM引脚到单片机
- > 充电过程并不涉及电压的改变，BUS端的电压只要是在8v以上即可。
- ![img.png](pic/限流.png)
- ![img.png](pic/充电限流电路.png)
- ![img.png](pic/LIM2.png)
## 2,放电过程（不做BAT端的限流）
> 注：PWM仅在放电模式下有效，内部弱下拉,悬空输出1/6 VBUS的值
### （1）~~这个过程应该不简单的，让我慢慢的摆烂~~，开玩笑的嘿嘿！
### （2）首先DIR引脚拉高，其他引脚暂时不变,设置一下放电最低电压，预设输出电压是24v，毕竟电池就16.8v，太高发热大，效率跟不上，~~其实是不敢尝试了~~，这样的话，VBUS的输出电压**就是4-24v可调**。
### （3）FB1电阻配置，预设输出24v，FB1上电阻620kΩ，下电阻33kΩ。
### （4）单独引出PWM引脚
###  ![img.png](pic/FB1配置.png)
###  ![img_1.png](pic/FB1动态调整.png)
###  （4）至于放电电流，仍然用 IPWM管脚调节，电路不变，由于前面的电流设置在6A，所以输出电流在1-6A可调。
![img.png](pic/放电.png)

# 总结一下
| 引脚   | ITUNE     | CSEL | PWM | IPWM | VREF      | FB1        | FB2                 | ILIM1      | ILIM2 |
|------|-----------|------|-----|------|-----------|------------|---------------------|------------|-------|
| 链接   | ILIM1电阻负端 | 0Ω到地 | IO  | IO   | 上56k，下10k | 上620k，下33k | 上130k+16k，下11k+0.4k | 120k到ITUNE | 120K  |



